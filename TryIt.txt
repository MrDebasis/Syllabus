trigger CareProgramEnrolleeTrigger on CareProgramEnrollee (after insert, after update) {
    List<Id> accountIdsToProcess = new List<Id>();

    if (Trigger.isInsert) {
        for (CareProgramEnrollee cpe : Trigger.New) {
            // Check for 'Verification Completed' status on insert
            if (cpe.Status == 'Verification Completed') {
                System.debug('Insert: CareProgramEnrollee ID: ' + cpe.Id);
                accountIdsToProcess.add(cpe.AccountId);
            }
        }
    }

    if (Trigger.isUpdate) {
        for (CareProgramEnrollee cpe : Trigger.New) {
            CareProgramEnrollee oldValue = Trigger.OldMap.get(cpe.Id);
            // Check if the status changed to 'Verification Completed'
            if (oldValue.Status != cpe.Status && cpe.Status == 'Verification Completed') {
                System.debug('Update: CareProgramEnrollee ID: ' + cpe.Id);
                accountIdsToProcess.add(cpe.AccountId);
            }
        }
    }

    // Process the accounts to create orders
    if (!accountIdsToProcess.isEmpty()) {
        Orders.createOrder(accountIdsToProcess);
    }
}
