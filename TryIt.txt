import { LightningElement, track } from 'lwc';
import { ShowToastEvent } from 'lightning/platformShowToastEvent';

export default class DynamicDatatableDebasis extends LightningElement {
    @track tables = [];

    config = {
        Account: {
            columns: [
                { label: 'Name', fieldName: 'Name', type: 'text', editable: true },
                { label: 'Industry', fieldName: 'Industry', type: 'text', editable: true },
                { label: 'Revenue', fieldName: 'Revenue', type: 'currency', editable: true }
            ],
            data: [
                { Id: '1', Name: 'Acme Corp', Industry: 'Manufacturing', Revenue: 500000 },
                { Id: '2', Name: 'Tech Innovators', Industry: 'Software', Revenue: 1200000 }
            ]
        },
        Contact: {
            columns: [
                { label: 'First Name', fieldName: 'FirstName', type: 'text', editable: true },
                { label: 'Last Name', fieldName: 'LastName', type: 'text', editable: true },
                { label: 'Email', fieldName: 'Email', type: 'email', editable: true }
            ],
            data: [
                { Id: '1', FirstName: 'John', LastName: 'Doe', Email: 'john.doe@example.com' },
                { Id: '2', FirstName: 'Jane', LastName: 'Smith', Email: 'jane.smith@example.com' }
            ]
        },
        AssociatedContact: {
            columns: [
                { label: 'First Name', fieldName: 'FirstName', type: 'text', editable: true },
                { label: 'Last Name', fieldName: 'LastName', type: 'text', editable: true },
                { label: 'Email', fieldName: 'Email', type: 'email', editable: true }
            ],
            data: [
                { Id: '1', FirstName: 'Debasis', LastName: 'Maharana', Email: 'Debasis@example.com' },
                { Id: '2', FirstName: 'Abcd', LastName: 'Abcd', Email: 'Abcd@example.com' }
            ]
        }
    };

    connectedCallback() {
        this.tables = Object.keys(this.config).map(objName => ({
            objectName: objName,
            columns: this.config[objName].columns,
            data: this.config[objName].data
        }));
    }

    handleSave(event) {
        const { objectName } = event.target.dataset;
        const updatedRecords = event.detail.draftValues;

        this.tables = this.tables.map(table => {
            if (table.objectName === objectName) {
                table.data = table.data.map(record => {
                    const updatedRecord = updatedRecords.find(upd => upd.Id === record.Id);
                    return updatedRecord ? { ...record, ...updatedRecord } : record;
                });
            }
            return table;
        });

        this.template.querySelectorAll('lightning-datatable').forEach(dt => dt.draftValues = []);

        this.showToast('Success', `${objectName} records updated successfully`, 'success');
    }


    showToast(title, message, variant) {
        const event = new ShowToastEvent({
            title: title,
            message: message,
            variant: variant
        });
        this.dispatchEvent(event);
    }
}


<template>
    <lightning-card title="Dynamic Data Tables">
        <template for:each={tables} for:item="table">
            <div key={table.objectName} class="slds-m-bottom_medium">
                <h2 class="slds-text-heading_medium">{table.objectName} Data</h2>
                
                <lightning-datatable
                    key-field="Id"
                    data={table.data}
                    columns={table.columns}
                    draft-values={table.draftValues}
                    onsave={handleSave}
                    data-object-name={table.objectName}
                    hide-checkbox-column>
                </lightning-datatable>
            </div>
        </template>
    </lightning-card>
</template>
