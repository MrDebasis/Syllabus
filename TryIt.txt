import { LightningElement, api, track } from 'lwc';

export default class Psp_PSSTrackerPaginationLWCComp extends LightningElement {
    @api currentPage = 1;
    @api totalRecords = 0;
    @api pageSize = 10;
    @api validPages = [];

    @track pageButtons = [];

    get totalPages() {
        return Math.ceil(this.totalRecords / this.pageSize);
    }

    get isPreviousDisabled() {
        return this.currentPage <= 1;
    }

    get isNextDisabled() {
        return this.currentPage >= this.totalPages;
    }

    @api
    refreshPagination(currentPage) {
        this.currentPage = currentPage;
        this.generatePageButtons();
    }

    connectedCallback() {
        this.generatePageButtons();
    }

    // Force update if input values change
    renderedCallback() {
        this.generatePageButtons();
    }

    generatePageButtons() {
        if (!this.totalRecords || !this.validPages || this.totalPages === 0) {
            this.pageButtons = [];
            return;
        }

        const maxVisiblePages = 5;
        let startPage = Math.max(1, this.currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = startPage + maxVisiblePages - 1;

        if (endPage > this.totalPages) {
            endPage = this.totalPages;
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        const pages = [];
        for (let i = startPage; i <= endPage; i++) {
            pages.push({
                page: i,
                disabled: !this.validPages.includes(i),
                variant: i === this.currentPage ? 'brand' : 'neutral'
            });
        }

        this.pageButtons = pages;
    }

    handlePreviousClick() {
        this.dispatchEvent(new CustomEvent('previous'));
    }

    handleNextClick() {
        this.dispatchEvent(new CustomEvent('next'));
    }

    handlePageClick(event) {
        const page = parseInt(event.target.dataset.page, 10);
        this.dispatchEvent(new CustomEvent('pagechange', { detail: page }));
    }
}


<template>
    <div class="pagination slds-m-top_medium slds-align_absolute-center">
        <lightning-button 
            disabled={isPreviousDisabled}
            onclick={handlePreviousClick}
            label="Previous">
        </lightning-button>

        <template for:each={pageButtons} for:item="btn">
            <lightning-button
                key={btn.page}
                class="slds-m-horizontal_xx-small"
                data-page={btn.page}
                onclick={handlePageClick}
                disabled={btn.disabled}
                variant={btn.variant}
                label={btn.page}>
            </lightning-button>
        </template>

        <lightning-button 
            disabled={isNextDisabled}
            onclick={handleNextClick}
            label="Next">
        </lightning-button>
    </div>
</template>
--------------------



get validPages() {
    return [...this.paginatedCasesMap.entries()]
        .filter(([page, records]) => records.length > 0)
        .map(([page]) => page);
}


<c-psp_-p-s-s-tracker-pagination-l-w-c-comp
    current-page={currentPage}
    total-records={casesFiltered.length}
    page-size="10"
    valid-pages={validPages}
    onprevious={handlePrevious}
    onnext={handleNext}
    onpagechange={handlePageClick}>
</c-psp_-p-s-s-tracker-pagination-l-w-c-comp>
