import { LightningElement, track } from 'lwc';
import uploadFileToContentDocument from '@salesforce/apex/FileUploadHandlerDemo.uploadFile';

export default class FileUploadPOC extends LightningElement {
    @track file; // Tracks the file upload status

    handleFileChange(event) {
        const file = event.target.files[0];

        if (!file) {
            alert('No file selected.');
            return;
        }

        if (file.size > 25 * 1024 * 1024) { // File size validation
            alert('File size exceeds 25 MB. Please upload a smaller file.');
            return;
        }

        this.readFile(file);
    }

    readFile(file) {
        const fileReader = new FileReader();

        fileReader.onload = () => {
            const base64 = fileReader.result.split(',')[1]; // Extract Base64
            const fileData = {
                fileName: file.name,
                base64Data: base64,
                contentType: file.type,
            };

            this.uploadFile(fileData);
        };

        fileReader.onerror = () => {
            alert('Error reading file. Please try again.');
            console.error('FileReader error:', fileReader.error);
        };

        fileReader.readAsDataURL(file); // Read file as Base64
    }

    uploadFile(fileData) {
        uploadFileToContentDocument(fileData)
            .then((contentDocumentId) => {
                alert(`File uploaded successfully! ContentDocumentId: ${contentDocumentId}`);
                this.file = { ...fileData, status: 'Uploaded' };
            })
            .catch((error) => {
                console.error('Error uploading file:', error);
                this.file = { ...fileData, status: 'Failed' };
                alert('Failed to upload file. Please try again.');
            });
    }
}

 <div>
        <lightning-input
            type="file"
            accept="image/png, image/jpeg"
            onchange={handleFileChange}
            label="Click to Upload File">
        </lightning-input>
        <template if:true={file}>
            <p>File: {file.fileName} - {file.status}</p>
        </template>
    </div>
